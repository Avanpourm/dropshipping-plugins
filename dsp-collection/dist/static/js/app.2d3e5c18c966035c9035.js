webpackJsonp([1],{"1/S8":function(t,a){},"3kCT":function(t,a){},NHnr:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=e("/5sW"),i=e("BO1k"),n=e.n(i),s={name:"Index",data:function(){return{productList:[],api_key:this.$cookies.get("am-api-key"),input:"8114333",currentPage:1,currentDate:new Date,pushNumber:0,pushNumberShow:!1,publishLoading:!1,organizationArray:["landon-test-01","dropshipping-release-incy","automizely-store"],organizationMap:{"landon-test-01":"9bba1ea4d5a144049772bef6b7a1841a","dropshipping-release-incy":"86cf3a92b2c04d849a6056e7cd82e043","automizely-store":"b82f5a20ae024f5f82f2a90e8a54bc35"},appData:{app:{key:"automizely-store",name:"aftership",platform:"shopify"},organization:{id:""}},priceFactors:[{min:0,max:499,factor:"1.5",originFactor:"2.5"},{min:500,max:999,factor:"1.25",originFactor:"2"},{min:1e3,max:999999999,factor:"1.1",originFactor:"1.5"}]}},created:function(){},methods:{initOrganization:function(){this.appData.organization.id=this.organizationMap[this.appData.app.key]},handleCurrentChange:function(t){this.currentPage=t,this.getProductsList(this.currentPage)},getProductsList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=this,e={};a.api_key&&(a.$cookies.set("am-api-key",a.api_key),e["am-api-key"]=a.api_key);var r=a.input.split(/[\s\n]/),i="";r&&(i=r.join(","));var s={page:t,limit:50};s.external_vendor_product_ids=i,a.$axios.get("https://platform.automizelyapi.com/suppliers/v1/products",{params:s,headers:e}).then(function(t){var e=t.data.data.products,r=!0,i=!1,s=void 0;try{for(var o,p=n()(e);!(r=(o=p.next()).done);r=!0){var c=o.value,u=!0,l=!1,d=void 0;try{for(var v,h=n()(c.variants);!(u=(v=h.next()).done);u=!0){var f=v.value;f.price.amount=_.round(f.price.amount,0)}}catch(t){l=!0,d=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw d}}c=a.productsPricesHandler(c)}}catch(t){i=!0,s=t}finally{try{!r&&p.return&&p.return()}finally{if(i)throw s}}a.productList=e})},pushProductsList:function(){var t=this,a=this;a.initOrganization(),a.publishLoading=!0,a.pushNumberShow=!0,a.pushNumber=0;var e={"am-api-key":a.api_key},r=function(r){var i=_.cloneDeepWith(r);i.app=a.appData.app,i.organization=a.appData.organization,a.$axios.post("https://product.automizelyapi.com/dropshipping/v1/products",i,{headers:e}).then(function(t){a.pushNumber++;var e=t.data.data.id;a.publishProduct(e,r),a.$set(r,"requestSuccess","推送中，请稍后~")}).catch(function(i){if(console.log(i.message),"Request failed with status code 409"==i.message){var n={universal_product_ids:r.universal_product_id,app_key:a.appData.app.key,app_platform:a.appData.app.platform,organization_id:a.appData.organization.id};a.$axios.get("https://product.automizelyapi.com/dropshipping/v1/products",{headers:e,params:n}).then(function(t){console.log(t.data.data)}),t.$set(r,"requestSuccess","此商品曾被推送成功")}else t.$set(r,"requestSuccess",""),t.$set(r,"requestErrorMsg","推送失败: "+i.message);a.publishLoading=!1})},i=!0,s=!1,o=void 0;try{for(var p,c=n()(a.productList);!(i=(p=c.next()).done);i=!0){r(p.value)}}catch(t){s=!0,o=t}finally{try{!i&&c.return&&c.return()}finally{if(s)throw o}}},getDropshippingProductId:function(t){},publishProduct:function(t,a){var e=this,r=this,i={"am-api-key":r.api_key},n=r.appData;r.$axios.post("https://product.automizelyapi.com/dropshipping/v1/products/"+t+"/publish",n,{headers:i}).then(function(t){r.publishLoading=!1,e.$set(a,"requestSuccess","推送成功")}).catch(function(t){r.publishLoading=!1,console.log("推送失败")})},productsPricesHandler:function(t){if(0==t.shipping_prices.length)return t;var a={},e=!0,r=!1,i=void 0;try{for(var s,o=n()(t.shipping_prices);!(e=(s=o.next()).done);e=!0){var p=s.value,c=p.shipping_options,u=(p.external_vendor_variant_ids,_.keyBy(c,function(t){return t.country+"-"+t.shipping_method})),l=null,d="";u["USA-USPS"]?(d="USPS",l=_.cloneDeep(u["USA-USPS"])):u["USA-4PX"]?(d="4PX",l=_.cloneDeep(u["USA-4PX"])):u["USA-US Express Shipping"]?(d="USPS",l=_.cloneDeep(u["USA-US Express Shipping"])):u["USA-US Standard"]&&(d="4PX",l=_.cloneDeep(u["USA-US Standard"])),t.shipping_title=d;try{l.prices=_.keyBy(l.prices,"unit")}catch(t){}if(!l)return t;var v=!0,h=!1,f=void 0;try{for(var m,y=n()(p.universal_variant_ids);!(v=(m=y.next()).done);v=!0){a[m.value]=l}}catch(t){h=!0,f=t}finally{try{!v&&y.return&&y.return()}finally{if(h)throw f}}}}catch(t){r=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw i}}var g=!0,b=!1,S=void 0;try{for(var x,k=n()(t.variants);!(g=(x=k.next()).done);g=!0){var P=x.value,w=a[P.universal_variant_id],z=0,C=!0,D=!1,U=void 0;try{for(var $,L=n()(this.priceFactors);!(C=($=L.next()).done);C=!0){var A=$.value;A.min<=P.price.amount&&P.price.amount<=A.max&&(z=_.round(_.multiply(P.price.amount,A.factor),0))}}catch(t){D=!0,U=t}finally{try{!C&&L.return&&L.return()}finally{if(D)throw U}}P.price.origin_amount=P.price.amount;try{P.price.shipping_amount=w.prices[1].amount,P.price.amount=_.round(_.add(z,w.prices[1].amount),0)}catch(t){}}}catch(t){b=!0,S=t}finally{try{!g&&k.return&&k.return()}finally{if(b)throw S}}return t}}},o={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"hello"},[e("el-form",[e("el-form-item",[e("el-input",{attrs:{type:"password",placeholder:"请输入API KEY"},model:{value:t.api_key,callback:function(a){t.api_key=a},expression:"api_key"}}),t._v(" "),e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.appData.app.key,callback:function(a){t.$set(t.appData.app,"key",a)},expression:"appData.app.key"}},t._l(t.organizationArray,function(t,a){return e("el-option",{key:t,attrs:{label:t,value:t}})})),t._v(" "),e("el-input",{attrs:{placeholder:"搜索内容",type:"textarea"},model:{value:t.input,callback:function(a){t.input=a},expression:"input"}})],1),t._v(" "),e("el-form-item",[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.getProductsList(1)}}},[t._v("商品查询")]),t._v(" "),e("el-popconfirm",{attrs:{title:"确定要推送这些商品吗？？"},on:{onConfirm:t.pushProductsList}},[e("el-button",{attrs:{slot:"reference",size:"small",loading:t.publishLoading},slot:"reference"},[t._v("推送选中的所有商品")])],1),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:t.pushNumberShow,expression:"pushNumberShow"}]},[t._v("推送成功数量:"+t._s(t.pushNumber))])],1)],1),t._v(" "),e("div",{staticStyle:{width:"96%",margin:"0 auto"}},[e("el-row",t._l(t.productList,function(a){return e("el-col",{key:a,staticStyle:{"margin-right":"6px","margin-bottom":"6px"},attrs:{span:11}},[e("el-card",{attrs:{"body-style":{padding:"0px"}}},[e("img",{staticClass:"image",attrs:{src:a.image_urls[0]}}),t._v(" "),e("div",{staticStyle:{padding:"8px"}},[e("b",{staticClass:"title"},[t._v(t._s(a.title))]),t._v(" "),t._l(a.variants.slice(0,1),function(r){return e("div",[e("span",{staticClass:"price-title"},[t._v("销售价:")]),t._v(" "),e("span",{staticClass:"price"},[t._v("$"+t._s(r.price.amount/100))]),t._v(" "),e("span",{staticClass:"price-title"},[t._v("成本价:")]),t._v(" "),e("span",{staticClass:"price"},[t._v("$"+t._s(r.price.origin_amount/100))]),t._v(" "),e("br"),t._v(" "),e("span",{staticClass:"price-title"},[t._v("运费价:")]),t._v(" "),e("span",{staticClass:"price"},[t._v("$"+t._s(r.price.shipping_amount/100))]),t._v(" "),e("br"),t._v(" "),e("span",{staticClass:"price-title"},[t._v("运输方式:")]),t._v(" "),e("span",[t._v(t._s(a.shipping_title))]),t._v(" "),e("span",{staticClass:"product-id"},[t._v(t._s(a.external_vendor_product_id))])])}),t._v(" "),e("div",{staticClass:"bottom clearfix"},[e("b",{staticStyle:{color:"red"}},[t._v(t._s(a.requestErrorMsg)+" ")]),t._v(" "),e("b",{staticStyle:{color:"green"}},[t._v(t._s(a.requestSuccess))])])],2)])],1)})),t._v(" "),e("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":100,layout:"prev, pager, next, jumper",total:6e4},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(a){t.currentPage=a}}})],1)],1)},staticRenderFns:[]};var p={name:"App",components:{Index:e("VU/8")(s,o,!1,function(t){e("1/S8")},"data-v-65352bb0",null).exports}},c={render:function(){var t=this.$createElement,a=this._self._c||t;return a("div",{attrs:{id:"app"}},[a("Index")],1)},staticRenderFns:[]};var u=e("VU/8")(p,c,!1,function(t){e("3kCT")},null,null).exports,l=e("mtWM"),d=e.n(l),v=(e("Rf8U"),e("mw3O")),h=e.n(v),f=e("zL8q"),m=e.n(f),y=(e("tvR6"),e("ppUw")),g=e.n(y),b=e("M4fF"),S=e.n(b);r.default.config.productionTip=!1,r.default.use(m.a),r.default.use(g.a),r.default.prototype.$axios=d.a,r.default.prototype.$qs=h.a,r.default.prototype._=S.a,d.a.defaults.headers.post["Content-Type"]="application/json",d.a.defaults.withCredentials=!0,new r.default({el:"#app",render:function(t){return t(u)}})},tvR6:function(t,a){}},["NHnr"]);
//# sourceMappingURL=app.2d3e5c18c966035c9035.js.map